{"sta":1,"data":{"subTitle":"打开一个IndexedDB数据库","content":"<p>首先，你需要知道你的浏览器是否支持IndexedDB。请使用最新版的谷歌浏览器或火狐浏览器。低版本的IE是不行的。&nbsp;</p><pre><code>window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;<br>\nif(!window.indexedDB)\n{\n    console.log(\"你的浏览器不支持IndexedDB\");\n}</code></pre><p>一旦你的浏览器支持IndexedDB，我们就可以打开它。你不能直接打开IndexedDB数据库。IndexedDB需要你创建一个请求来打开它。</p><pre><code>var request = window.indexedDB.open(\"testDB\", 2);</code></pre><p>第一个参数是数据库的名称，第二个参数是数据库的版本号。版本号可以在升级数据库时用来调整数据库结构和数据。\n<br>\n<br>但你增加数据库版本号时，会触发onupgradeneeded事件，这时可能会出现成功、失败和阻止事件三种情况。</p><pre><code>var db;\nrequest.onerror = function(event){\n    console.log(\"打开DB失败\", event);\n}\nrequest.onupgradeneeded   = function(event){\n    console.log(\"Upgrading\");\n    db = event.target.result;\n    var objectStore = db.createObjectStore(\"students\", { keyPath : \"rollNo\" });\n};\nrequest.onsuccess  = function(event){\n    console.log(\"成功打开DB\");\n    db = event.target.result;\n}</code></pre><p>onupgradeneeded事件在第一次打开页面初始化数据库时会被调用，或在当有版本号变化时。所以，你应该在onupgradeneeded函数里创建你的存储数据。如果没有版本号变化，而且页面之前被打开过，你会获得一个onsuccess事件。如果有错误发生时则触发onerror事件。如果你之前没有关闭连接，则会触发onblocked事件。\n<br>\n<br>在上面的代码片段里，我们创建了一个Object Store，叫做“students”，用“rollNo”做数据键名。</p>"}}