{"sta":1,"data":{"subTitle":"EnvironmentPlugin","content":"<h3>EnvironmentPlugin</h3><p><code>EnvironmentPlugin</code>是在<a href=\"https://nodejs.org/api/process.html#process_process_env\" target=\"_blank\"><code>process.env</code></a><span>&nbsp;</span>键(key) 上使用<code>DefinePlugin</code>的简写方式。</p><h3>用法</h3><p><code>EnvironmentPlugin</code>接受任意一个键(key)的数组。</p><pre><code><span>new</span> <span>webpack<span>.</span>EnvironmentPlugin</span><span>(</span><span>[</span><span>'NODE_ENV'</span><span>,</span> <span>'DEBUG'</span><span>]</span><span>)</span>\n</code></pre><p>这相当于以下<span>&nbsp;</span><code>DefinePlugin</code><span>&nbsp;</span>应用程序：</p><pre><code><span>new</span> <span>webpack<span>.</span>DefinePlugin</span><span>(</span><span>{</span>\n  <span>'process.env.NODE_ENV'</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span>process<span>.</span>env<span>.</span>NODE_ENV<span>)</span><span>,</span>\n  <span>'process.env.DEBUG'</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span>process<span>.</span>env<span>.</span>DEBUG<span>)</span>\n<span>}</span><span>)</span>\n\nT<span>&gt;</span> 不指定环境变量会引发\"<span><span>`EnvironmentPlugin`</span></span> <span>-</span> <span><span>`</span><span><span>${</span>key<span>}</span></span><span>`</span></span> environment variable is undefined\"（环境变量未定义）错误。\n\n## 带默认值的用法\n\n或者，<span><span>`EnvironmentPlugin`</span></span> <span>支持一个对象，它将键</span><span>(</span>key<span>)</span>映射到其默认值。 如果在<span><span>`process.env`</span></span><span>中未定义键，则采用键键</span><span>(</span>key<span>)</span>的默认值。\n\n<span><span>``</span></span>`js\n<span>new</span> <span>webpack<span>.</span>EnvironmentPlugin</span><span>(</span><span>{</span>\n  NODE_ENV<span>:</span> <span>'development'</span><span>,</span> <span spellcheck=\"true\">// 使用 'development' ，除非 process.env.NODE_ENV 被定义</span>\n  DEBUG<span>:</span> <span>false</span>\n<span>}</span><span>)</span>\n</code></pre><p>W&gt; 来自<span>&nbsp;</span><code>process.env</code><span>&nbsp;</span>are always strings的变量总是字符串。</p><p>T&gt; 与<code>DefinePlugin</code>不同，默认值通过<span>&nbsp;</span><code>EnvironmentPlugin</code><span>&nbsp;</span>应用于<code>JSON.stringify</code>。</p><p>T&gt; 要指定未设置的默认值，请使用<span>&nbsp;</span><code>null</code><span>&nbsp;</span>而不是<span>&nbsp;</span><code>undefined</code>。</p><h3>示例:</h3><p>当在测试文件<span>&nbsp;</span><code>entry.js</code><span>&nbsp;</span>上运行以前的<code>EnvironmentPlugin</code>配置时，让我们查看结果：</p><pre><code><span>if</span> <span>(</span>process<span>.</span>env<span>.</span>NODE_ENV <span>===</span> <span>'production'</span><span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Welcome to production'</span><span>)</span><span>;</span>\n<span>}</span>\n<span>if</span> <span>(</span>process<span>.</span>env<span>.</span>DEBUG<span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Debugging output'</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><p>当在终端中执行<span>&nbsp;</span><code>NODE_ENV=production webpack</code><span>&nbsp;</span>构建时，<code>entry.js</code>变为：</p><pre><code><span>if</span> <span>(</span><span>'production'</span> <span>===</span> <span>'production'</span><span>)</span> <span>{</span> <span spellcheck=\"true\">// &lt;-- 'production' from NODE_ENV is taken</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Welcome to production'</span><span>)</span><span>;</span>\n<span>}</span>\n<span>if</span> <span>(</span><span>false</span><span>)</span> <span>{</span> <span spellcheck=\"true\">// &lt;-- default value is taken</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Debugging output'</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><p>运行<span>&nbsp;</span><code>DEBUG=false webpack</code><span>&nbsp;</span>生成:</p><pre><code><span>if</span> <span>(</span><span>'development'</span> <span>===</span> <span>'production'</span><span>)</span> <span>{</span> <span spellcheck=\"true\">// &lt;-- default value is taken</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Welcome to production'</span><span>)</span><span>;</span>\n<span>}</span>\n<span>if</span> <span>(</span><span>'false'</span><span>)</span> <span>{</span> <span spellcheck=\"true\">// &lt;-- 'false' from DEBUG is taken</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Debugging output'</span><span>)</span><span>;</span>\n<span>}</span></code></pre>"}}