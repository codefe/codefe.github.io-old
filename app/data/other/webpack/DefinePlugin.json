{"sta":1,"data":{"subTitle":"DefinePlugin","content":"<h3 id=\"defineplugin\">DefinePlugin</h3><pre><code><span>new</span> <span>webpack<span>.</span>DefinePlugin</span><span>(</span>definitions<span>)</span>\n</code></pre><p>允许你创建一个在编译时可以配置的全局常量。这可能会对开发模式和发布模式的构建允许不同的行为非常有用。比如,你可能会用一个全局的常量来决定 log 在开发模式触发而不是发布模式。这仅仅是<span>&nbsp;</span><code>DefinePlugin</code><span>&nbsp;</span>提供的便利的一个场景。</p><h3>示例:</h3><pre><code><span>new</span> <span>webpack<span>.</span>DefinePlugin</span><span>(</span><span>{</span>\n  PRODUCTION<span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>true</span><span>)</span><span>,</span>\n  VERSION<span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>\"5fa3b9\"</span><span>)</span><span>,</span>\n  BROWSER_SUPPORTS_HTML5<span>:</span> <span>true</span><span>,</span>\n  TWO<span>:</span> <span>\"1+1\"</span><span>,</span>\n  <span>\"typeof window\"</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>\"object\"</span><span>)</span>\n<span>}</span><span>)</span>\n</code></pre><pre><code>console<span>.</span><span>log</span><span>(</span><span>\"Running App version \"</span> <span>+</span> VERSION<span>)</span><span>;</span>\n<span>if</span><span>(</span><span>!</span>BROWSER_SUPPORTS_HTML5<span>)</span> <span>require</span><span>(</span><span>\"html5shiv\"</span><span>)</span><span>;</span>\n</code></pre><p>T&gt; 注意，因为这个插件直接做的文本替换,给定的值必须包含字符串本身内的实际引号。通常，有两种方式来达到这个效果，使用<span>&nbsp;</span><code>'\"production\"'</code>, 或者使用<span>&nbsp;</span><code>JSON.stringify('production')</code>。</p><p>每个传进<span>&nbsp;</span><code>DefinePlugin</code><span>&nbsp;</span>的键值都是一个标志符或者多个用<span>&nbsp;</span><code>.</code><span>&nbsp;</span>连接起来的标志符。</p><ul><li>如果这个值是一个字符串，它会被当作一个代码片段来使用。</li><li>如果这个值不是字符串，它会被转化为字符串(包括函数)。</li><li>如果这个值是一个对象，它所有的 key 会被同样的方式定义。</li><li>如果在一个 key 前面加了<span>&nbsp;</span><code>typeof</code>,它会被定义为 typeof 调用。</li></ul><p>这些值会被内联进那些允许传一个代码压缩参数的代码中，从而减少冗余的条件判断。</p><h3>示例:</h3><pre><code><span>if</span> <span>(</span><span>!</span>PRODUCTION<span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Debug info'</span><span>)</span>\n<span>}</span>\n<span>if</span> <span>(</span>PRODUCTION<span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Production log'</span><span>)</span>\n<span>}</span>\n<span><span>``</span></span>\n</code></pre><p>通过没有使用压缩的 webpack 的结果:</p><pre><code><span>if</span> <span>(</span><span>!</span><span>true</span><span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Debug info'</span><span>)</span>\n<span>}</span>\n<span>if</span> <span>(</span><span>true</span><span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span><span>'Production log'</span><span>)</span>\n<span>}</span>\n</code></pre><p>通过使用压缩的 webpack 的结果:</p><pre><code>console<span>.</span><span>log</span><span>(</span><span>'Production log'</span><span>)</span>\n</code></pre><h3 id=\"use-case-feature-flags\">Use Case: Feature Flags</h3><p>Enable/disable features in production/development build using<span>&nbsp;</span><a href=\"https://en.wikipedia.org/wiki/Feature_toggle\" target=\"_blank\">feature flags</a>.</p><pre><code><span>new</span> <span>webpack<span>.</span>DefinePlugin</span><span>(</span><span>{</span>\n  <span>'NICE_FEATURE'</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>true</span><span>)</span><span>,</span>\n  <span>'EXPERIMENTAL_FEATURE'</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>false</span><span>)</span>\n<span>}</span><span>)</span>\n</code></pre><h3 id=\"use-case-service-urls\">Use Case: Service URLs</h3><p>Use a different service URL in production/development builds:</p><pre><code><span>new</span> <span>webpack<span>.</span>DefinePlugin</span><span>(</span><span>{</span>\n  <span>'SERVICE_URL'</span><span>:</span> JSON<span>.</span><span>stringify</span><span>(</span><span>\"http://dev.example.com\"</span><span>)</span>\n<span>}</span><span>)</span></code></pre>"}}