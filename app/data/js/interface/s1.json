{"sta":1,"data":{"subTitle":"把json导出为xls","content":"<p>js代码如下：</p><pre><code>var fun = {\n\t//格式化下载数据\n\tformatDownData: function(data,arr){\n\t\tvar newData = [];\n\t\tfor (var i = 0,len=data.length; i &lt; len; i++) {\n\t\t\tvar key = Object.keys(data[i]);\n\t\t\tnewData[i] = [];\n\t\t\tfor(var j=0,k=arr.length;j&lt;k;j++){\n\t\t\t\tif(key.indexOf(arr[j]) &gt; -1){\n\t\t\t\t\tnewData[i].push({value:data[i][arr[j]],type:'ROW_HEADER'});\n\t\t\t\t}else{\n                                        newData[i].push({value:'-',type:'ROW_HEADER'});\n                                }\n\t\t\t}\n\t\t}\n\t\treturn newData;\n\t},\n\t//json to xls\n\tJSONToExcelConvertor: function(JSONData, FileName, ShowLabel){\n\t\t//先转化json\n\t\tvar arrData = typeof JSONData !== 'object' ? JSON.parse(JSONData) : JSONData;\n\t\tvar excel = '&lt;table&gt;';\n\t\t//设置表头\n\t\tvar row = \"&lt;tr&gt;\";\n\t\tfor (var a = 0, l = ShowLabel.length; a &lt; l; a++) {\n\t\t\trow += \"&lt;td&gt;\" + ShowLabel[a].value + '&lt;/td&gt;';\n\t\t}\n\t\t//换行\n\t\texcel += row + \"&lt;/tr&gt;\";\n\t\t//设置数据\n\t\tfor (var i = 0; i &lt; arrData.length; i++) {\n\t\t\tvar rowa = \"&lt;tr&gt;\";\n\t\t\tfor (var index in arrData[i]) {\n\t\t\t\tvar value = arrData[i][index].value === \".\" ? \"\" : arrData[i][index].value;\n\t\t\t\trowa += '&lt;td&gt;' + value + '&lt;/td&gt;';\n\t\t\t}\n\t\t\texcel += rowa + \"&lt;/tr&gt;\";\n\t\t}\n\n\t\texcel += \"&lt;/table&gt;\";\n\n\t\tvar excelFile = \"&lt;html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'&gt;\";\n\t\texcelFile += '&lt;meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\"&gt;';\n\t\texcelFile += '&lt;meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel';\n\t\texcelFile += '; charset=UTF-8\"&gt;';\n\t\texcelFile += \"&lt;head&gt;\";\n\t\texcelFile += \"&lt;!--[if gte mso 9]&gt;\";\n\t\texcelFile += \"&lt;xml&gt;\";\n\t\texcelFile += \"&lt;x:ExcelWorkbook&gt;\";\n\t\texcelFile += \"&lt;x:ExcelWorksheets&gt;\";\n\t\texcelFile += \"&lt;x:ExcelWorksheet&gt;\";\n\t\texcelFile += \"&lt;x:Name&gt;\";\n\t\texcelFile += \"{worksheet}\";\n\t\texcelFile += \"&lt;/x:Name&gt;\";\n\t\texcelFile += \"&lt;x:WorksheetOptions&gt;\";\n\t\texcelFile += \"&lt;x:DisplayGridlines/&gt;\";\n\t\texcelFile += \"&lt;/x:WorksheetOptions&gt;\";\n\t\texcelFile += \"&lt;/x:ExcelWorksheet&gt;\";\n\t\texcelFile += \"&lt;/x:ExcelWorksheets&gt;\";\n\t\texcelFile += \"&lt;/x:ExcelWorkbook&gt;\";\n\t\texcelFile += \"&lt;/xml&gt;\";\n\t\texcelFile += \"&lt;![endif]--&gt;\";\n\t\texcelFile += \"&lt;/head&gt;\";\n\t\texcelFile += \"&lt;body&gt;\";\n\t\texcelFile += excel;\n\t\texcelFile += \"&lt;/body&gt;\";\n\t\texcelFile += \"&lt;/html&gt;\";\n\n\t\tvar uri = 'data:application/vnd.ms-excel;charset=utf-8,' + encodeURIComponent(excelFile);\n\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = uri;\n\n\t\tlink.style = \"visibility:hidden\";\n\t\tlink.download = FileName + \".xls\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t}\n}</code></pre><p>调用：</p><pre><code>var downData = {\n\ttitle: [\n\t\t{\"value\":\"名称\", \"type\":\"ROW_HEADER_HEADER\", \"datatype\":\"string\"},\n\t\t{\"value\":\"事件\", \"type\":\"ROW_HEADER_HEADER\", \"datatype\":\"string\"},\n\t\t{\"value\":\"转化率\", \"type\":\"ROW_HEADER_HEADER\", \"datatype\":\"string\"}\n\t],\n\tdata: fun.formatDownData(dataLists,['name','event','rate'])\n};\nfun.JSONToExcelConvertor(downData.data, \"filename\", downData.title);</code></pre><p>dataLists 为数据源,数据源中必须包含fun.JSONToExcelConvertor函数第2个参数据中的属性，格式为：</p><pre><code>[\n{id:xxx,name:xxx,event:xxx,rate:xxx,time:xxx},\n{id:xxx,name:xxx,event:xxx,rate:xxx,time:xxx},\n{id:xxx,name:xxx,event:xxx,rate:xxx,time:xxx},\n...\n]</code></pre><p>要用fun.formatDownData转换一下，第二个参数是要的字段(注意要与title的顺序一致)。</p>"}}